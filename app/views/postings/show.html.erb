<%
@board = @posting.board
if @board.access == Posting::PRIVATE && !current_user.member?(@board)
return "This is a private post."
end
%>
<p id="notice"><%= notice %></p>

<div id="posting_content">

<% if current_user.id == @posting.user_id %>
<div class="float_right">
    <%= link_to 'Edit', edit_posting_path(@posting), :class => "edit_button" %>

    <%= link_to 'Delete', @posting, confirm: 'Are you sure?',
        method: :delete, :class => "delete_button"
    %>
</div>
<% end %>

<br class="clearBoth" />

<div class="float_right">
      <%= render 'votes/vote_btn', :element => @posting %>
</div>

<div class="posting_left_column clearfix">
    <% if !@posting.subject.nil? && !@posting.subject.empty? %>
    <div class="inline subject"><%= ( strip_and_cut(@posting.subject,120) ) %></div>
    <% end %>

    <div class="inline">        
        <% if @posting.active_user %>
            <% if current_user.id == @posting.user_id %>
            posted by me
            <% elsif user = @posting.user %>
                <%= link_to "#{user.full_name}", user_path(@posting.user_id) %>
            <% else %>Unknown user<% end %>
        <% else %>Unknown user<% end %>
    </div>
        
    <% unless @posting.created_at.nil? %>
        <div class="inline"><%= @posting.created_at.getlocal.strftime("%m/%d/%Y %I:%M%p") %><br />
            <i>(<%= (time_ago_in_words(@posting.created_at)+" ago") %>)</i></div>
    <% end %>
  
    <div class="inline clickable">
        <% if @board %>
        <b><%= link_to "#{strip_and_cut(@board.title,30)}", home_path + "?board=#{@posting.board_id}", :class => "link_to_text" %></b>
        <% else %>
        <i>(Board was removed)</i>
        <% end %>
    </div>

    <% if !@board.nil? && !@board.school_id.nil? %>
    <% school = School.find_school(@board.school_id) %>
    <div class="inline clickable">
        <b><%= link_to "#{strip_and_cut(school.name,30)}", home_path + "?school=#{school.id}", :class => "link_to_text" %></b>
    </div>
    <% end %>
</div>

<div class="posting_right_column clearfix">
	<div class="inline">
    <%= strip_and_cut( @posting.content, 300 ) %>
    </div>
    <% unless @posting.view_count == 0 %>
    <div class="inline"><%= pluralize( @posting.view_count, 'UP')  %></div>
    <% end %>
    <% if @posting.access == Posting::PRIVATE %>
    <div class="inline"><i><font color="#808080"><%= @posting.access %></font></i></div>
    <% end %>
</div>

<br class="clearBoth" />
<p><b>Full content:</b><br />
<%= @posting.content %>
</p>

<% if current_user.id != @posting.user_id %>
<%= render 'reply_form' %>
<% end %>

<%= link_to 'Home', home_path + "?board=#{@board.id}", :class => "button_neutral" %>

</div> <!-- end of posting_element -->
