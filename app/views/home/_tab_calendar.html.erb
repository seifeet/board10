<% return nil unless @board || @posting  %>
<div class="clearfix">
<% @date = Date.today unless @date %>
<% @events = @posting.get_future_events_for_month(@date) if @posting && @events.nil? %>
<% board_id = (@board && @board.id ? @board.id : @posting.board_id) %>
<% if @posting %>
<div class="close_button clearfix clickable">
<%= link_to "Close", home_path + "?board=#{board_id}", :title => "Close Calendar", :disable_with => "Closing..." %>
</div>
<% end %>
<%= render 'home/calendar_btns' %>
<div class="calendar_sub_title">
  <div class="heading clickable">
  <%= link_to "<", {:board => board_id, :date => ((@date - 1.year).end_of_month).strftime("%Y-%m-%d")}, :title => "Previous year", :disable_with => "<" %>
  <%= @date.strftime("%Y") %>
  <%= link_to ">", {:board => board_id, :date => ((@date + 1.year).end_of_month).strftime("%Y-%m-%d")}, :title => "Next year", :disable_with => ">" %>
  </div>
  <div class="heading clickable">
  <%= link_to "<", {:board => board_id, :date => ((@date - 1.month).end_of_month).strftime("%Y-%m-%d")}, :title => "Previous month", :disable_with => "<" %>
  <%= @date.strftime("%B") %>
  <%= link_to ">", {:board => board_id, :date => ((@date + 1.month).end_of_month).strftime("%Y-%m-%d")}, :title => "Next month", :disable_with => ">" %>
  </div>
</div>
<div id="calendar">
<%= calendar_for @events, :year => @date.year, :month => @date.month do |calendar| %>
  <%= calendar.head('Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat') %>
  <% calendar.day(:day_method => :next_event) do |date, events| %>
    <% if date == Date.today %>
    <div class="cal_today_link clickable">
    <% elsif date == @date %>
    <div class="cal_curr_link clickable">
    <% else %>
    <div class="cal_link clickable">
    <% end %>
    <%= link_to date.day, {:board => board_id, :date => (date).strftime("%Y-%m-%d")}, :title => "View posts for #{(date).strftime('%Y-%m-%d')}", :disable_with => "#{date.day}..." %>
    <% if events.any? && @date.month == date.month %>
    <% if date == @date && params[:subact] == "events_only" %>
    <div class="curr_event_count clickable">
    <% else %>
    <div class="event_count clickable">
    <% end %>
    	<%= link_to "x"+events.count.to_s, {:board => board_id, :date => (date).strftime("%Y-%m-%d"), :subact => "events_only"}, :title => "View events for #{(date).strftime('%Y-%m-%d')}", :disable_with => "...x#{events.count.to_s}" %>
    </div>
    <% end %>
    </div>
  <% end %>
<% end %>
</div>
</div>